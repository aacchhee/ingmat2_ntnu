# Optimering

Her skal vi se på hvordan vi kan bruke kritiske punkter til å finne globale maksimum og minimum på lukkede domener i $\mathbb{R}^2$.

Vi begynner med en repetisjon av tilsvarende optimering i 1D, før vi gå videre til 2D.

### 1. Funksjoner av en variabel (repetisjon)

Nøkkelen her er følgende setning: en kontinuerlig funksjon $f:[a,b]\rightarrow \mathbb{R}$ har en maksimumsverdi og en minimumsverdi.

Er funksjonen i tillegg deriverbar kan vi finner maksimumsverdien og minimumsverdien som følger:

1. Finn alle kritiske punkter $x$.
2. Maksimums- og minimumspunkter er enten et kritisk punkt eller på randen ($a$ eller $b$).
3. Beregne $f(x)$ for alle kritiske punkter, i tillegg til $f(a)$ og $f(b)$. 
4. Velg den minste/største verdien.

### Eksempel 1

La oss se på $f(x) = x^3 - x^2 - x + 1$, $-2\leq x \leq 2$.

Hva er maksimums- og minimumsverdien?

Vi beregner

$$
f'(x) = 3x^2 - 2x - 1 = (3x+1)(x-1)
$$

Vi har altså kritiske punkter ved $x=-\frac{1}{3}$ og $x=1$. Den andre deriverte er

$$
f''(x) = 6x - 2,
$$

slik at $f''(1)=4$ og $f''(-\frac{1}{3})=-4$. Dermed er $x=1$ et lokalt minimumspunkt og $x=-1$ et lokalt maksimumspunkt.

Vi må sjekke også endepunktene/randpunktene $x=-2$ og $x=2$. Om vi skriver ned funksjonsverdien i disse fire punktene får vi

1. $f(-2)=(-2)^3 - (-2)^2 - (-2) + 1 = -8 - 4 + 2 + 1 = -9$
2. $f(-\frac{1}{3}) = (-\frac{1}{3})^3 - (-\frac{1}{3})^2 - (-\frac{1}{3}) + 1 = 1.185$
3. $f(1) = 1^3 - 1^2 - 1 + 1 = 0$
4. $f(2) = 2^3 - 2^2 - 2 + 1 = 8 - 4 - 2 + 1 = 3$.

Siden den minste verdien er i punktet $x=-2$ er $-9$ minimumsverdien til $f$, mens den største er i punktet $x=2$, som gir oss maksimumsverdi $3$. La oss dobbeltsjekke ved å plotte funksjonen.

```{pyodide-python}
import matplotlib.pyplot as plt
plt.close("all")

# Importer pakker for plotting og numeriske beregninger
import matplotlib.pyplot as plt
import numpy as np

# Lag 100 punkter i intervallet [-2,2]
x = np.linspace(-2, 2, 100)

# Finn funksjonsverdiene
y = x**3 - (x**2) - x + 1

# Plott funksjonen
plt.plot(x, y)

plt.show()
```

### Eksempel 2: Funksjon uten maks/min

Livet er ikke alltid like lett! La $f:(0,1)\rightarrow \mathbb{R}$ være definert som

$$
f(x) = \frac{1}{x}.
$$

Denne funksjonen har ikke noen maksimumsverdi, siden $f(x)$ går mot uendelig når $x\rightarrow 0$. Vi kan heller ikke sette inn $x=0$, siden dette punktet ikke er i definisjonsområdet til funksjonen.

Dette strider ikke mot vår tidligere setning, som kun gjaldt for deriverbare funksjoner hvor definisjonsområdet $[a,b]$ er et lukket intervall, dvs. endepunktene er med.

### 2. Funksjoner av to variabler

En funksjon $f: D \subset \mathbb{R}^2 \rightarrow \mathbb{R}$ har garantert en maksimumsverdi/minimumsverdi hvis $D$ er *kompakt*. Kompakt betyr at randen er med i $D$, samtidig som $D$ ikke inneholder punkter uendelig langt vekke fra origo. Vi skal ikke fokusere på hva det vil si å være kompakt, men et eksempel er et lukket rektangel $[a,b]\times[c,d]$. 


I så fall kan vi finne maks/min punkter ved å følge samme fremgangsmåte som for en variabel, med en forskjell: randen består ikke lenger av to punkter $(a,b)$, men er generelt mer komplisert.

For eksempel, for $[a,b]\times [c,d]$ består randen av 4 linjer:
1. $x=a, c\leq y \leq d$
2. $x=b, c\leq y \leq d$
3. $a\leq x\leq b, y=c$
4. $a\leq x\leq b, y=d$

Vi må altså sjekke hvor $f(x)$ er største/minste på de fire linjene over. Hver linje gir oss et optimeringsproblem i en variabel, f.eks. på linje 1 må vi finne maksimums-/minimumsverdien av

$$
g(y) = f(a,y), \quad c\leq y\leq d.
$$

Maksimums- og minimumsverdien av $f$ kan også befinne seg i hjørnene av $[a,b]\times[c,d]$. Det vil si at vi må finne den største/minste verdien av de kritiske punktene, på punktene på linjene 1.-4., og de fire hjørnepunktene $(a,c), (a,d), (b,c), (b,d)$.

### Eksempel 3

La oss se på 
$$
f(x,y) = x^2 - 2xy + 2y^2 - 2y + 1,
$$
definert på $0\leq x\leq 3, 0\leq y\leq 2$.

1. Første finner vi de partiellderiverte:

$$
\frac{\partial f}{\partial x}(x,y) = 2x - 2y, \quad
\frac{\partial f}{\partial y}(x,y) = -2x + 4y - 2
$$

2. Deretter finner vi de kritiske punktene ved å løse:
$$
\begin{pmatrix}
2 & -2 \\
-2 & 4
\end{pmatrix}
\begin{pmatrix}
x \\
y
\end{pmatrix}
=
\begin{pmatrix}
0 \\
2
\end{pmatrix}.
$$
Her får vi en entydig løsning $x=1, y=1$.

3. Vi får fire endimensjonale optimeringsproblemer langs randen:

    1. $x=0, 0\leq y\leq 2$. Her er
    $$
    g_1(y)=f(0,y) = 2y^2 - 2y + 1,
    $$
    Funksjonen $g_1$ har kritiske punkter når $g_1'(y)=4y-2=0$, altså $y=0.5$. Dermed er en ny maksimums/minimumspunkt kandidat $x=0, y=0.5$
    
    2. $x=3, 0\leq y\leq 2$. Her er
    $$
    g_2(y)=f(3,y) = 2y^2 -8y + 10
    $$
    Som har kritiske punkter når $g_2'(y)=4y-8=0$, altså $y=2$. En ny kandidat er da $x=0, y=2$
    
    3. $y=0, 0\leq x\leq 3$. Her er
    $$
    g_3(x)=f(x,0) = x^2 + 1
    $$
    Som har kritiske punkter når $g_3'(x)=2x=0$, alstå $x=0$. En ny kandidat er da $x=y=0$
    
    4. $y=2, 0\leq x\leq 3$. Her er
    $$
    g_4(x)=f(x,2) = x^2 - 4x + 5
    $$
    Som har kritiske punkter når $g_4'(x)=2x-4=0$, altså $x=2$. En ny kandidat er da $x=2, y=2$
    
4. Vi må også sjekke hjørnene: $(0,0), (0,2),(3,0),$ og $(3,2)$.
    
Vi har: 

$$
\begin{align}
f(1,1) &= 1^2 - 2\cdot 1\cdot 1 + 2\cdot 1^2 - 2\cdot 1 + 1 = 0 \\
f(0,0.5) &= 0^2 - 2\cdot 0\cdot 0.5 + 2\cdot 0.5^2 - 2\cdot 0.5 + 1 = 0.5 \\
f(2,2) &= 2^2 - 2\cdot 2\cdot 2 + 2\cdot 2^2 - 2\cdot 2 + 1 = 1 \\
f(0,0) &= 0^2 - 2\cdot 0\cdot 0 + 2\cdot 0.5^0 - 2\cdot 0 + 1 = 1 \\
f(0,2) &= 0^2 - 2\cdot 0\cdot 2 + 2\cdot 2^2 - 2\cdot 2 + 1 = 5 \\
f(3,0) &= 3^2 - 2\cdot 3\cdot 0 + 2\cdot 0^2 - 2\cdot 0 + 1 = 10 \\
f(3,2) &= 3^2 - 2\cdot 3\cdot 2 + 2\cdot 2^2 - 2\cdot 2 + 1 = 2 
\end{align}
$$

Den største er $f(3,0)=10$, dvs. $f$ har maksimumsverdien 10 i punktet $x=3, y=0$. Minimumsverdien er $f(1,1)=0$ i minimumspunktet $x=1, y=1$.

```{pyodide-python}
import numpy as np
import matplotlib.pyplot as plt
plt.close("all")

# Bestemmer at vi skal plotte i 3d, samt størelsen på plottet
fig, ax = plt.subplots(subplot_kw={'projection': '3d'})

# Lager rutenettet for plotting
x, y = np.meshgrid(np.linspace(0, 3, 100), np.linspace(0, 2, 100))

# Lager funksjonsverdiene
z = x ** 2 - 2*x*y + 2*(y**2) - 2*y + 1

# Lager overflateplottet
ax.plot_surface(x, y, z)

plt.show()
```

### Eksempel 4

Hva med funksjonen $f(x,y) = \sqrt{2x^2 + y^2}$, for $x^2 + y^2 \leq 4$?
Siden randen $x^2 + y^2 = 4$ er med, og den ikke inneholder punkter uendelig langt vekke fra origo, har $f$ en minimumsverdi og en maksimumsverdi.


Det eneste kritiske punktet til funksjoen $f$ er i origo som er et lokalt minimumspunkt med minimumsverdi $0$ (se oppgaven under). Så vi har ingen maksimumskandidater inni sirkelen, og disse må derfor ligge på randen. Randen til $x^2 + y^2 \leq 4$ er sirkelen $x^2 + y^2 = 4$. Regner vi ut $f$ langs randen får vi

$$
f(x,y) = \sqrt{2x^2 + y^2} = \sqrt{x^2 + (x^2 + y^2)} = \sqrt{x^2 + 4}
$$

Maksimumspunktene er altså hvor $x$ (og dermed $x^2$) er størst i området $x^2 + y^2 \leq 4$, nemlig ved $x=\pm 2$. Tilsvarende $y$-verdi langs randen er $0$, siden dette er eneste måten å oppfylle $x^2 + y^2 = 4$ når $x=\pm 2$. Siden vi ikke har noen lokale maksimumspunkter inni sirkelen, vil $(\pm 2, 0)$ være maksimumspunktene som gir maksimumsverdi $f(\pm 2, 0)=\sqrt{8}$.

Minimumspunktet lang randen er når $x=0$, som gir oss $f(0,\pm 2)=2$. Dermed er minimumspunktet $(0,0)$ og minimumsverdien $0$.
#### Oppgave:
Vis at det eneste kritiske punktet til funksjonen $f$ er i origo, og vis at dette er et lokalt minimumspunkt.

```{pyodide-python}
import numpy as np
import matplotlib.pyplot as plt
plt.close("all")

# Bestemmer at vi skal plotte i 3d, samt størelsen på plottet
fig, ax = plt.subplots(subplot_kw={'projection': '3d'})

# Lager rutenettet for plotting
x, y = np.meshgrid(np.linspace(-2, 2, 100), np.linspace(-2, 2, 100))

# Lager funksjonsverdiene
z = np.sqrt(2*x**2 + y**2)

# Lager overflateplottet
ax.plot_surface(x, y, z)

plt.show()
```